"use strict";let ITEM_PREFIX="mbc_",auth_items=["client_id","client_secret","vehicle_id","api_key"],scope_items=["fuelstatus","evstatus","vehiclelock","vehiclestatus","payasyoudrive"],image_items=["night","roofOpen","background","cropped","jpeg"],auth_data={client_id:"",client_secret:"",vehicle_id:"",api_key:""},image_options={},scopes="";window.addEventListener("load",function(){function t(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");let n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)"),a=n.exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}let e=function(t){let e="/rest/items/"+ITEM_PREFIX+t+"/state";return $.ajax({url:e,type:"GET",timeout:3e3}).then(function(n){let a=document.getElementById("item_"+t);if(n.length>10)auth_data[t]=n,$("#item_"+t).html("ok"),a.className+=" table-success",document.getElementById("item_"+t).setAttribute("title",n);else{$("#item_"+t).html("not set"),a.className+=" table-danger",document.getElementById("item_"+t).setAttribute("title",n);let c=document.getElementById("send_"+t);c.innerHTML='<th scope="row"><input id="input-'+t+'" type="text" class="form-control" placeholder="Enter '+t.toUpperCase().replace("_"," ")+'" aria-label="Enter '+t.toUpperCase().replace("_"," ")+'" aria-describedby="button-addon2"></th> <td><button id="btn-'+t+'" class="btn btn-outline-secondary" type="button">send</button></td>',document.getElementById("btn-"+t).addEventListener("click",function(){let n=document.getElementById("input-"+t);$.ajax({url:e,type:"PUT",contentType:"text/plain",data:n.value,success:window.location.reload(!0)})},!1)}document.getElementById("c-switch-auth-"+t).addEventListener("click",function(){$.ajax({url:e,type:"PUT",contentType:"text/plain",data:"",success:window.location.reload(!0)})},!1)})};for(let t=0;t<auth_items.length;t++){const n=auth_items[t];e(n)}let n=function(t){let e="/rest/items/"+ITEM_PREFIX+"scope_"+t+"/state";return $.ajax({url:e,type:"GET",timeout:3e3}).then(function(n){let a=document.getElementById("scope_"+t),c=document.getElementById("c-switch-scope-"+t);"ON"===n?(scopes=scopes+"mb:vehicle:mbdata:"+t+" ",$("#scope_"+t).html("active"),a.className+=" table-success",c.innerHTML='<div class="text-center form-switch"> <input class="form-check-input" type="checkbox" id="switch-scope-'+t+'" checked> </div>'):($("#scope_"+t).html("not active"),a.className+=" table-danger",c.innerHTML='<div class="text-center form-switch"> <input class="form-check-input" type="checkbox" id="switch-scope-'+t+'"> </div>'),document.getElementById("switch-scope-"+t).addEventListener("click",function(){let t="ON";"ON"==n&&(t="OFF"),$.ajax({url:e,type:"PUT",contentType:"text/plain",data:t,success:window.location.reload(!0)})},!1)})};for(let t=0;t<scope_items.length;t++){const e=scope_items[t];n(e)}let a=function(t){let e="/rest/items/"+ITEM_PREFIX+"data_imageoption_"+t+"/state";return $.ajax({url:e,type:"GET",timeout:3e3}).then(function(n){let a=document.getElementById("item_imageoption_"+t),c=document.getElementById("c-switch-img-"+t);"ON"===n?(image_options[t]="true",$("#item_imageoption_"+t).html("active"),a.className+=" table-success",c.innerHTML='<div class="text-center form-switch"> <input class="form-check-input" type="checkbox" id="switch-img-'+t+'" checked> </div>'):(image_options[t]="false",$("#item_imageoption_"+t).html("not active"),a.className+=" table-danger",c.innerHTML='<div class="text-center form-switch"> <input class="form-check-input" type="checkbox" id="switch-img-'+t+'"> </div>'),document.getElementById("switch-img-"+t).addEventListener("click",function(){let t="ON";"ON"==n&&(t="OFF"),$.ajax({url:e,type:"PUT",contentType:"text/plain",data:t,success:window.location.reload(!0)})},!1)})};for(let t=0;t<image_items.length;t++){const e=image_items[t];a(e)}let c=t("code",document.location.href),i=window.location,o=i.pathname.split(".html")[0]+".html",l=document.getElementById("auth_button");if(setTimeout(()=>{if("NULL"!=auth_data.client_id&&"NULL"!=auth_data.client_secret&&"NULL"!=auth_data.vehicle_id&&auth_data.client_id.length>30&&auth_data.client_secret.length>30&&auth_data.vehicle_id.length>15){if(null===c)if(encodeURI(document.location.href).includes("error_description")){$("#reload").html("Wrong URL, please reload this page to clean the URL!");let t=document.getElementById("reload");t.className+="text-danger",l.className+=" btn-danger",$("#link").attr("href",o),l.textContent="Reload",$("#auth_area").html("")}else{function t(t){let e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",a=n.length;for(let c=0;c<t;c++)e+=n.charAt(Math.floor(Math.random()*a));return e}let e=t(64);l.className+="btn btn-dark";let n="https://id.mercedes-benz.com/as/authorization.oauth2?response_type=code&client_id="+auth_data.client_id+"&redirect_uri="+encodeURI(document.location.href).split(".html")[0]+".html&scope="+scopes+"offline_access&state="+e;$("#link").attr("href",n),l.textContent="Authenticate",$("#auth_area").html(""),$.ajax({url:"/rest/items/"+ITEM_PREFIX+"auth_state/state",method:"PUT",contentType:"text/plain",data:e})}}else $("#status").html("Prerequisites missing!"),l.className+=" btn-danger",$("#link").attr("href",o),l.textContent="Reload",$("#auth_area").html("")},500),null!==c)c.length>10&&$.get("/rest/items/"+ITEM_PREFIX+"auth_state/state",function(e){let n=t("state",document.location.href);n==e?(l.className="btn btn-success",l.textContent="Success! / Reload",$("#link").attr("href",o),$("#auth_code").html(c),$.ajax({url:"/rest/items/"+ITEM_PREFIX+"auth_code/state",method:"PUT",contentType:"text/plain",data:c,statusCode:{202:function(){$("#status").html("New Mercedes Benz API Auth Code successfully saved to openHAB!")}}}),$.ajax({url:"/rest/items/"+ITEM_PREFIX+"redirect_url/state",method:"PUT",contentType:"text/plain",data:encodeURI(document.location.href).split(".html")[0]+".html"}),$.ajax({url:"/rest/items/"+ITEM_PREFIX+"auth_code_trigger/state",method:"PUT",contentType:"text/plain",data:"ON"})):($("#status").html("Wrong state! CSRF attack?"),l.className+=" btn-danger",$("#link").attr("href",o),l.textContent="ERROR / Reload",$("#auth_area").html(""))});else{let e=t("error_description",document.location.href),n=document.getElementById("error_description");n.className+="text-danger",$("#status").html(e),l.className+=" btn-danger",$("#link").attr("href",o),l.textContent="ERROR",$("#auth_area").html("")}let s=encodeURI(document.location.href).split(".html")[0]+".html";document.getElementById("redirecturl").textContent=s;document.getElementById("copybtn").addEventListener("click",function(){$("<input>").val(s).appendTo("body").select();document.execCommand("copy"),$("[data-toggle='tooltip']").tooltip("show"),setTimeout(function(){$("[data-toggle='tooltip']").tooltip("disable")},1e3)})});